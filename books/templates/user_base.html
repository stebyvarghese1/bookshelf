{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>{% block title %}Bookshelf{% endblock %}</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="{% static 'css/theme.css' %}">
    <style>
      /* üîç Search toggle styles */
      .search-box {
        display: none;
        position: absolute;
        right: 70px; /* leaves space before theme toggle */
        top: 10px;
        background: #fff;
        border-radius: 6px;
        padding: 5px 10px;
        box-shadow: 0 2px 6px rgba(0,0,0,0.2);
        z-index: 1000;
      }
      .search-box input {
        border: none;
        outline: none;
        font-size: 0.9rem;
        width: 200px;
      }
      .search-btn, #themeToggle {
        border: none;
        background: transparent;
        font-size: 1.2rem;
        margin-left: 10px;
        cursor: pointer;
      }
    </style>
</head>
<body>
<nav class="navbar navbar-expand-lg navbar-dark">
    <div class="container position-relative">
        <a class="navbar-brand" href="{% url 'bookshelf' %}">üìö Bookshelf</a>
        <div class="d-flex align-items-center ms-auto">
            <!-- üîç Search button -->
            <button id="searchToggle" class="search-btn">üîç</button>
            <!-- üåô Theme button -->
            <button id="themeToggle" class="theme-toggle-btn">üåô</button>
        </div>

        <!-- Hidden Search Box -->
        <div id="searchBox" class="search-box">
            <input type="text" id="bookSearch" placeholder="Search books...">
        </div>
    </div>
</nav>

<div class="container mt-4">
    {% block content %}{% endblock %}
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.1/dist/js/bootstrap.bundle.min.js"></script>
<script src="{% static 'js/theme-toggle.js' %}"></script>
<script>
  // üîç Toggle search box
  const searchToggle = document.getElementById("searchToggle");
  const searchBox = document.getElementById("searchBox");
  searchToggle.addEventListener("click", () => {
      if (searchBox.style.display === "block") {
          searchBox.style.display = "none";
      } else {
          searchBox.style.display = "block";
          document.getElementById("bookSearch").focus();
      }
  });

  // üîé Live filter books (works with bookshelf template)
  document.addEventListener("input", function(e) {
      if (e.target.id === "bookSearch") {
          let query = e.target.value.toLowerCase();
          let books = document.querySelectorAll(".book-item");
          let noResult = document.getElementById("noResult");

          let found = false;
          books.forEach(book => {
              let title = book.querySelector(".card-title")?.textContent.toLowerCase() || "";
              let author = book.querySelector(".card-text")?.textContent.toLowerCase() || "";
              if (title.includes(query) || author.includes(query)) {
                  book.style.display = "block";
                  found = true;
              } else {
                  book.style.display = "none";
              }
          });

          if (!found) {
              if (!noResult) {
                  noResult = document.createElement("p");
                  noResult.id = "noResult";
                  noResult.className = "text-muted mt-3";
                  noResult.innerText = "üö´ No books found.";
                  document.querySelector(".bookshelf-wrapper")?.appendChild(noResult);
              }
          } else if (noResult) {
              noResult.remove();
          }
      }
  });
</script>
</body>
</html>
