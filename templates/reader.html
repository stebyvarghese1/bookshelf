{% extends "base.html" %}
{% block title %}{{ book.title }}{% endblock %}
{% block content %}
<section class="reader">
  <div class="reader__sidebar">
    <div class="book-card">
      <img src="{{ cover_url }}" alt="cover" class="book-card__cover">
      <div class="book-card__meta">
        <h2>{{ book.title }}</h2>
        <p class="muted">{{ book.author }}</p>
      </div>
    </div>
    <div class="tts-panel">
      <h3>AI Emotion Reader</h3>
      <p class="muted">Select text or let it read the page. Voice varies pitch/rate based on detected emotion.</p>
      <div class="row">
        <button id="btnReadSelection">Read Selection</button>
        <button id="btnReadPage">Read Page</button>
        <button id="btnStop">Stop</button>
      </div>
      <div id="emotionStatus" class="muted"></div>
    </div>
  </div>

  <div class="reader__main">
    <div id="viewerContainer">
      <!-- PDF.js viewer canvas pages will be injected here -->
    </div>
    <div class="page-turn-hint">Click/drag horizontally to turn pages</div>
  </div>
</section>

<!-- PDF.js (CDN) -->
<script src="https://cdnjs.cloudflare.com/ajax/libs/pdf.js/4.5.136/pdf.min.js" integrity="sha512-TyVT8nvvnAd6ZSe2p2eS2Xo1Bz8HjU12q5b2v3q0CskfPG2CzFJv9uIQkq3eC8gnM5Yt9z7r9O5tGdI3u3TzGQ==" crossorigin="anonymous" referrerpolicy="no-referrer"></script>

<script>
  // PDF.js init
  const BOOK_ID = "{{ book._id }}";
  const PDF_URL = "{{ url_for('book_file', book_id=book._id) }}";
</script>
<script src="{{ url_for('static', filename='js/reader.js') }}"></script>
{% endblock %}
